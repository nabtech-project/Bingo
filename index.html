<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Bingo Multi/Single with Own Board & Modals</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-database-compat.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            background: #f5f7fa;
            text-align: center;
        }

        h1 {
            padding: 20px 0 0;
            margin: 0;
        }

        button {
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
        }

        .primary {
            background: #289944;
            color: white;
        }

        .primary:hover {
            background: #1e7836;
        }

        .secondary {
            background: #ccc;
        }

        #modeSelect {
            margin: 15px 0;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(5, 60px);
            gap: 6px;
            margin: 20px auto;
        }

        .cell {
            background: white;
            border: 1px solid #aaa;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 60px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        .marked {
            background: #289944;
            color: white;
        }

        #historyBox {
            background: white;
            border-radius: 8px;
            padding: 8px 14px;
            margin-top: 12px;
            display: inline-block;
            min-width: 180px;
        }

        #historyNums span {
            display: inline-block;
            margin: 2px;
            padding: 2px 6px;
            border-radius: 4px;
            background: #eee;
        }

        #status {
            font-weight: bold;
            margin: 14px;
            min-height: 24px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 320px;
            width: 90%;
            text-align: center;
            animation: pop 0.3s ease;
        }

        @keyframes pop {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal h2 {
            margin: 0 0 10px;
        }

        .modal input {
            padding: 8px;
            width: 90%;
            margin-top: 10px;
        }

        .modal button {
            margin-top: 14px;
        }
    </style>
</head>

<body>

    <h1>ðŸŽ¯ Bingo (1â€“25)</h1>
    <div id="modeSelect">
        <button class="primary" id="btnSingle">Single Player</button>
        <button class="primary" id="btnMulti">Multiplayer</button>
    </div>

    <div id="gameArea" style="display:none;">
        <h3 id="playerLabel"></h3>
        <div id="playerBoard" class="board"></div>
        <div id="controls">
            <input type="number" min="1" max="25" id="calledNumber" placeholder="Enter number">
            <button class="primary" id="btnCall">Call Number</button>
            <button class="secondary" id="btnNewGame">New Game</button>
        </div>
        <div id="historyBox"><b>History:</b>
            <div id="historyNums"></div>
        </div>
        <div id="status"></div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modalContent"></div>
    </div>

    <audio id="markSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
    <audio id="winSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

    <script>
        /* ==== Firebase ==== */
        const firebaseConfig = {
            apiKey: "AIzaSyCboYlDXD-nX10yHeJYD6bg1g5Lh1FZmfY",
            authDomain: "bingo-86f88.firebaseapp.com",
            databaseURL: "https://bingo-86f88-default-rtdb.firebaseio.com",
            projectId: "bingo-86f88",
            storageBucket: "bingo-86f88.appspot.com",
            messagingSenderId: "583431421151",
            appId: "1:583431421151:web:aaba4a9b1a4ba5bbbf7d6a"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        /* ==== State ==== */
        let mode = "single", playerId = null, roomCode = null, board = [], marks = [], calledNumbers = [], gameOver = false, isCreator = false;

        /* ==== Helpers ==== */
        function generateBoard() {
            let nums = Array.from({ length: 25 }, (_, i) => i + 1);
            nums.sort(() => Math.random() - 0.5);
            return nums;
        }
        function renderBoard() {
            const div = document.getElementById('playerBoard');
            div.innerHTML = '';
            board.forEach((num, idx) => {
                let cell = document.createElement('div');
                cell.className = 'cell';
                if (marks[idx]) cell.classList.add('marked');
                cell.textContent = num;
                div.appendChild(cell);
            });
        }
        function renderHistory() {
            const cont = document.getElementById('historyNums');
            cont.innerHTML = '';
            calledNumbers.forEach(n => {
                let sp = document.createElement('span');
                sp.textContent = n;
                cont.appendChild(sp);
            });
        }
        function showModal(html) {
            document.getElementById('modalContent').innerHTML = html;
            document.getElementById('modalOverlay').style.display = 'flex';
        }
        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
        }
        function countLines(m) {
            let lines = 0;
            for (let r = 0; r < 5; r++) { if (m.slice(r * 5, r * 5 + 5).every(Boolean)) lines++; }
            for (let c = 0; c < 5; c++) { let col = []; for (let r = 0; r < 5; r++) col.push(m[r * 5 + c]); if (col.every(Boolean)) lines++; }
            if ([0, 6, 12, 18, 24].every(i => m[i])) lines++;
            if ([4, 8, 12, 16, 20].every(i => m[i])) lines++;
            return lines;
        }

        /* ==== Single Player ==== */
        function setupSingle() {
            playerId = "YOU";
            board = generateBoard();
            marks = Array(25).fill(false);
            calledNumbers = []; gameOver = false;
            document.getElementById('playerLabel').textContent = "You";
            renderBoard(); renderHistory();
            document.getElementById('gameArea').style.display = '';
            document.getElementById('status').textContent = '';
        }
        function callNumberSingle(num) {
            if (!num || num < 1 || num > 25 || calledNumbers.includes(num) || gameOver) return;
            calledNumbers.push(num);
            board.forEach((val, idx) => { if (val === num) marks[idx] = true; });
            document.getElementById('markSound').play();
            renderBoard(); renderHistory();
            if (countLines(marks) >= 5) {
                gameOver = true; document.getElementById('winSound').play();
                showModal(`<h2>ðŸŽ‰ You won!</h2><button class="primary" onclick="closeModal()">OK</button>`);
            }
        }

        /* ==== Multiplayer ==== */
        function createRoom() {
            roomCode = Math.floor(100000 + Math.random() * 900000);
            playerId = "P" + Math.floor(Math.random() * 10000);
            isCreator = true;
            board = generateBoard(); marks = Array(25).fill(false); calledNumbers = []; gameOver = false;
            db.ref('rooms/' + roomCode).set({
                calledNumbers: [],
                players: {
                    [playerId]: { board: board, marks: marks }
                }
            });
            subscribeRoom();
            showModal(`<h2>Room Created</h2><p>Code: <b>${roomCode}</b></p><button class="primary" onclick="closeModal()">OK</button>`);
        }
        function joinRoomPrompt() {
            showModal(`<h2>Join Room</h2><input type="text" id="joinCode" placeholder="Enter code"><br>
  <button class="primary" onclick="joinRoom()">Join</button>`);
        }
        function joinRoom() {
            let code = document.getElementById('joinCode').value.trim();
            if (!code) return;
            roomCode = code; playerId = "P" + Math.floor(Math.random() * 10000);
            board = generateBoard(); marks = Array(25).fill(false);
            db.ref('rooms/' + roomCode + '/players/' + playerId).set({ board: board, marks: marks });
            subscribeRoom();
            closeModal();
        }
        function subscribeRoom() {
            document.getElementById('playerLabel').textContent = "You (Room " + roomCode + ")";
            document.getElementById('gameArea').style.display = '';
            db.ref('rooms/' + roomCode).on('value', snap => {
                const val = snap.val(); if (!val) return;
                if (val.players && val.players[playerId]) {
                    board = val.players[playerId].board;
                    marks = val.players[playerId].marks;
                }
                calledNumbers = val.calledNumbers || [];
                renderBoard(); renderHistory();
                // Win detection
                if (countLines(marks) >= 5 && !gameOver) {
                    gameOver = true; document.getElementById('winSound').play();
                    showModal(`<h2>ðŸŽ‰ You got Bingo!</h2><button class="primary" onclick="closeModal()">OK</button>`);
                }
            });
        }
        function callNumberMulti(num) {
            if (!roomCode || !num || num < 1 || num > 25 || calledNumbers.includes(num) || gameOver) return;
            calledNumbers.push(num);
            // mark for this player
            board.forEach((val, idx) => { if (val === num) marks[idx] = true; });
            db.ref('rooms/' + roomCode + '/calledNumbers').set(calledNumbers);
            db.ref('rooms/' + roomCode + '/players/' + playerId + '/marks').set(marks);
            document.getElementById('markSound').play();
        }

        /* ==== Events ==== */
        document.getElementById('btnSingle').onclick = () => { mode = "single"; setupSingle(); closeModal(); }
        document.getElementById('btnMulti').onclick = () => {
            mode = "multi";
            showModal(`<h2>Multiplayer</h2>
    <button class="primary" onclick="createRoom()">Create Room</button>
    <button class="primary" onclick="joinRoomPrompt()">Join Room</button>`);
        };
        document.getElementById('btnCall').onclick = () => {
            let n = parseInt(document.getElementById('calledNumber').value);
            document.getElementById('calledNumber').value = '';
            if (mode === "single") callNumberSingle(n); else callNumberMulti(n);
        };
        document.getElementById('btnNewGame').onclick = () => {
            if (mode === "single") setupSingle();
            else showModal(`<h2>Restart</h2><p>Leave and create/join a new room for a fresh game</p><button class="primary" onclick="closeModal()">OK</button>`);
        };

        /* ==== Start ==== */
        setupSingle();
    </script>
</body>

</html>